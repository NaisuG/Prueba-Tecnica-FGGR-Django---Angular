<div class="container">
  <h1>Gesti√≥n de Productos</h1>

  <div class="card form-section">
    <h2>Nuevo Producto</h2>

    <div class="form-group">
      <label>Nombre <span class="req">*</span>:</label>
      <input type="text" [(ngModel)]="nombre" 
             [class.error-border]="intentoGuardar && !nombre"
             placeholder="Ej: Laptop Gamer">
      @if (intentoGuardar && !nombre) { <small class="error-msg">Campo obligatorio</small> }
    </div>

    <div class="form-group">
      <label>Fecha <span class="req">*</span>:</label>
      <input type="date" [(ngModel)]="fecha"
             [class.error-border]="intentoGuardar && !fecha">
      @if (intentoGuardar && !fecha) { <small class="error-msg">Campo obligatorio</small> }
    </div>

    <div class="row">
      <div class="form-group col">
        <label>Valor <span class="req">*</span>:</label>
        <input type="number" [(ngModel)]="valor" min="0" step="0.01"
               [class.error-border]="intentoGuardar && valor === null"
               placeholder="0">
        @if (intentoGuardar && valor === null) { <small class="error-msg">Campo obligatorio</small> }
      </div>
      
      <div class="form-group col-small">
        <label>Moneda:</label>

        <input type="text" 
                list="listaMonedas" 
                [(ngModel)]="moneda" 
                placeholder="Buscar..."
                class="input-moneda">
        <datalist id="listaMonedas">
          @for (m of monedasDisponibles; track m.code) {
            <option value="{{ m.code }}">{{ m.name }}</option>
          }
        </datalist>        
      </div>
    </div>

    <div class="form-group">
      <label>Imagen (Opcional):</label>
      <input type="file" id="fileInput" (change)="onFileSelected($event)" accept="image/*">
    </div>

    <button (click)="iniciarGuardado()" 
            [disabled]="valor !== null && valor < 0" 
            class="btn-save">
      Guardar Producto
    </button>
    @if (valor !== null && valor < 0) { <small class="error-msg">No se permiten valores negativos</small> }
  </div>

  <hr>

  <div class="list-section">
    <h2>Inventario</h2>
    <div class="grid">
      @for (prod of listaProductos; track prod.id) {
        <div class="card product-card">
          <button class="btn-delete" (click)="borrarProducto(prod.id, prod.nombre)" title="Eliminar">
            üóëÔ∏è
          </button>

          @if (prod.imagen) {
            <img [src]="prod.imagen" alt="{{ prod.nombre }}">
          } @else {
            <div class="no-image">Sin Imagen</div>
          }
          
          <div class="info">
            <h3>{{ prod.nombre }}</h3>
            <p class="date">üìÖ {{ prod.fecha }}</p>
            <p class="price">
              {{ prod.moneda }} {{ prod.valor | number : obtenerFormatoMoneda(prod.moneda) }}
            </p>
          </div>
        </div>
      } @empty {
        <p>No hay productos.</p>
      }
    </div>
  </div>
</div>

@if (mostrarModalDuplicado) {
  <div class="modal-overlay">
    <div class="modal-content">
      <h3 class="warning-title">‚ö†Ô∏è ¬°Producto Duplicado!</h3>
      <p>Ya existe un producto llamado "<strong>{{ productoDuplicadoEncontrado.nombre }}</strong>" en el sistema.</p>
      
      <div class="duplicate-info">
        <p><strong>Datos actuales en Base de Datos:</strong></p>
        <ul>
          <li>Fecha: {{ productoDuplicadoEncontrado.fecha }}</li>
          <li>Precio: {{ productoDuplicadoEncontrado.moneda }} {{ productoDuplicadoEncontrado.valor | number : obtenerFormatoMoneda(productoDuplicadoEncontrado.moneda) }}</li>
          <li>ID: {{ productoDuplicadoEncontrado.id }}</li>
        </ul>
      </div>

      <p class="question">¬øQu√© desea hacer?</p>
      
      <div class="modal-actions">
        <button class="btn-cancel" (click)="resolverDuplicado('cancelar')">Cancelar</button>
        <button class="btn-add" (click)="resolverDuplicado('agregar')">A√±adir Nuevo (Duplicar)</button>
        <button class="btn-replace" (click)="resolverDuplicado('reemplazar')">Reemplazar Existente</button>
      </div>
    </div>
  </div>
}